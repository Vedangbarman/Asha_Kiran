<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help Finder - Asha Kiran</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary: #A2B9D1; /* Soft, Desaturated Blue */
            --primary-dark: #8E9EAE;
            --secondary: #B2D8B2; /* Gentle Mint Green */
            --accent: #D6CADD; /* Soothing Lavender */
            --darker-bg: #F4F1E9; /* Main Background - Parchment */
            --text-primary: #3C3633; /* Soft Black */
            --text-secondary: #746C65; /* Warm Grey */
            --navbar-bg: rgba(244, 241, 233, 0.7);
        }

        html { scroll-behavior: smooth; scroll-padding-top: 80px; }
        body { font-family: 'Space Grotesk', sans-serif; background-color: var(--darker-bg); color: var(--text-primary); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--dark-bg); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, var(--primary), var(--secondary)); border-radius: 4px; }

        .nav-link { position: relative; }
        .nav-link::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 2px; background: linear-gradient(to right, var(--secondary), var(--primary)); transition: width 0.3s ease; transform: translateX(-50%); }
        .nav-link:hover::after, .nav-link.active::after { width: 80%; }
        
        #mobile-menu-button.active #line1 { transform: rotate(45deg) translate(4px, 4px); }
        #mobile-menu-button.active #line2 { opacity: 0; }
        #mobile-menu-button.active #line3 { transform: rotate(-45deg) translate(4px, -4px); }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-dark);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute top-20 left-10 w-96 h-96 bg-[var(--primary)]/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 right-10 w-80 h-80 bg-[var(--accent)]/10 rounded-full blur-3xl"></div>
    </div>
    
    <nav id="navbar" class="sticky top-0 bg-[var(--navbar-bg)] backdrop-blur-lg border-b border-gray-300/80 z-50">
    <div class="container mx-auto px-6 py-3">
        <div class="flex items-center justify-between">
            <a href="{{ url_for('home') }}" class="flex items-center">
                <div class="relative mr-2">
                    <div class="absolute inset-0 bg-[var(--secondary)]/30 rounded-md blur-sm"></div>
                    <div class="w-10 h-10 rounded-md bg-gradient-to-br from-[var(--primary)] to-[var(--secondary)] border border-blue-200/30 flex items-center justify-center relative shadow-lg shadow-blue-800/10">
                        <div class="absolute inset-[3px] bg-gray-50 rounded-[4px] flex items-center justify-center overflow-hidden">
                            <div class="font-bold text-lg bg-gradient-to-r from-[var(--primary-dark)] to-[var(--secondary)] bg-clip-text text-transparent">AK</div>
                        </div>
                    </div>
                </div>
                <div class="text-xl font-medium bg-gradient-to-r from-[var(--primary-dark)] to-[var(--accent)] bg-clip-text text-transparent flex items-center">Asha Kiran</div>
            </a>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-1">
                <a href="{{ url_for('home') }}" class="nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-4 py-2">Home</a>
                <a href="{{ url_for('mental_ai') }}" class="nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-4 py-2">Mental Health AI</a>
                <a href="{{ url_for('toolkit') }}" class="nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-4 py-2">Toolkit</a>
                <a href="{{ url_for('directory') }}" class="nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-4 py-2">Directory</a>
                <a href="{{ url_for('help_finder') }}" class="nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-4 py-2">Find Help</a>
                <a href="{{ url_for('contact') }}" class="nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-4 py-2">Contact</a>
            </div>

            <!-- Mobile Menu Button -->
            <div class="flex md:hidden">
                <button id="mobile-menu-button" class="relative w-10 h-10 focus:outline-none" aria-label="Toggle menu">
                    <div class="w-5 h-5 flex flex-col justify-between items-center transform transition-all duration-300">
                        <span id="line1" class="block h-0.5 w-5 bg-[var(--primary-dark)] transition duration-300"></span>
                        <span id="line2" class="block h-0.5 w-5 bg-[var(--primary-dark)] transition duration-300"></span>
                        <span id="line3" class="block h-0.5 w-5 bg-[var(--primary-dark)] transition duration-300"></span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden h-0 overflow-hidden transition-all duration-300">
            <div class="pt-2 pb-3 px-2 space-y-1">
                <a href="{{ url_for('home') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Home</a>
                <a href="{{ url_for('mental_ai') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Mental Health AI</a>
                <a href="{{ url_for('toolkit') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Toolkit</a>
                <a href="{{ url_for('directory') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Directory</a>
                <a href="{{ url_for('help_finder') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Find Help</a>
                <a href="{{ url_for('contact') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Contact</a>
            </div>
        </div>
    </div>
</nav>

            <div class="flex md:hidden">
                <button id="mobile-menu-button" class="relative w-10 h-10 focus:outline-none" aria-label="Toggle menu">
                    <div class="w-5 h-5 flex flex-col justify-between items-center transform transition-all duration-300">
                        <span id="line1" class="block h-0.5 w-5 bg-[var(--primary-dark)] transition duration-300"></span>
                        <span id="line2" class="block h-0.5 w-5 bg-[var(--primary-dark)] transition duration-300"></span>
                        <span id="line3" class="block h-0.5 w-5 bg-[var(--primary-dark)] transition duration-300"></span>
                    </div>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="md:hidden h-0 overflow-hidden transition-all duration-300">
            <div class="pt-2 pb-3 px-2 space-y-1">
                <a href="{{ url_for('home') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Home</a>
                <a href="{{ url_for('mental_ai') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Mental Health AI</a>
                <a href="{{ url_for('toolkit') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Toolkit</a>
                <a href="{{ url_for('directory') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Directory</a>
                <a href="{{ url_for('find_help') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Find Help</a>
                <a href="{{ url_for('contact') }}" class="block nav-link text-[var(--text-secondary)] hover:text-[var(--primary-dark)] px-3 py-2 rounded-md">Contact</a>
            </div>
        </div>
    </div>
</nav>

    <main class="flex-grow container mx-auto px-4 py-12">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-[var(--primary-dark)] to-[var(--secondary)] bg-clip-text text-transparent mb-4">Find Help Near You</h1>
            <h2 class="text-xl text-[var(--primary-dark)] font-medium max-w-3xl mx-auto">You are not alone in this. Let us help you find the support you deserve.</h2>
        </div>

        <div class="max-w-3xl mx-auto bg-yellow-100/50 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-r-lg mb-8">
            <p class="font-semibold">Important Disclaimer:</p>
            <p class="text-sm">The results on this page are generated by an AI using publicly available information from Google Search. This is not an endorsement. Please always verify credentials and information independently before seeking help.</p>
        </div>

        <div class="max-w-3xl mx-auto bg-[#E9E3D5]/50 backdrop-blur-lg border border-[var(--primary)]/20 rounded-xl shadow-xl p-8">
            <form id="search-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="location-input" class="block text-sm font-medium text-[var(--text-secondary)] mb-2">Enter Pincode or Full Address</label>
                        <input type="text" id="location-input" placeholder="e.g., 110001 or Connaught Place, New Delhi" class="w-full bg-gray-200/50 border border-gray-300/80 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">
                    </div>
                    <div class="flex items-end">
                        <button type="button" id="current-location-btn" class="w-full bg-white border border-gray-300/80 rounded-lg p-3 flex items-center justify-center gap-2 hover:bg-gray-100 transition-colors">
                            <svg class="w-5 h-5 text-[var(--primary-dark)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            <span>Use Current Location</span>
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2">What are you looking for?</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <label class="bg-white/70 border border-gray-300/80 rounded-lg p-4 text-center cursor-pointer has-[:checked]:bg-[var(--primary)]/20 has-[:checked]:border-[var(--primary)]">
                            <input type="radio" name="resource-type" value="certified doctors or psychiatrists" class="sr-only" checked>
                            <span class="font-semibold text-[var(--text-primary)]">Doctors</span>
                        </label>
                        <label class="bg-white/70 border border-gray-300/80 rounded-lg p-4 text-center cursor-pointer has-[:checked]:bg-[var(--primary)]/20 has-[:checked]:border-[var(--primary)]">
                            <input type="radio" name="resource-type" value="mental health centers or clinics" class="sr-only">
                            <span class="font-semibold text-[var(--text-primary)]">Centers</span>
                        </label>
                        <label class="bg-white/70 border border-gray-300/80 rounded-lg p-4 text-center cursor-pointer has-[:checked]:bg-[var(--primary)]/20 has-[:checked]:border-[var(--primary)]">
                            <input type="radio" name="resource-type" value="mental health support groups or meetups" class="sr-only">
                            <span class="font-semibold text-[var(--text-primary)]">Meetups</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white font-bold py-3 rounded-lg text-lg hover:opacity-90 transition-opacity">
                    Find Help
                </button>
            </form>
        </div>

        <div id="post-search-info" class="max-w-3xl mx-auto mt-16 text-center">
            <div class="mb-12">
                 <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-2">Why Use This Tool?</h2>
                 <p class="text-[var(--text-secondary)] mb-6">When you're feeling overwhelmed, a simple search can be stressful. We designed this tool to be different.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-[#E9E3D5]/50 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg text-[var(--text-primary)]">Curated Results</h3>
                        <p class="text-sm text-[var(--text-secondary)]">No ads or clutter. Just a focused list to help you find what you need.</p>
                    </div>
                    <div class="bg-[#E9E3D5]/50 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg text-[var(--text-primary)]">Smart Filtering</h3>
                        <p class="text-sm text-[var(--text-secondary)]">Our AI prioritizes higher-rated professionals to help you find quality care.</p>
                    </div>
                    <div class="bg-[#E9E3D5]/50 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg text-[var(--text-primary)]">Less Overwhelm</h3>
                        <p class="text-sm text-[var(--text-secondary)]">A simple, calm interface designed to make your search easier during a stressful time.</p>
                    </div>
                </div>
            </div>

            <div>
                <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-2">What Kind of Help Can You Find?</h2>
                <p class="text-[var(--text-secondary)] mb-6">Our tool helps you connect with different types of local support.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white/70 p-6 rounded-lg border border-gray-300/80">
                        <h3 class="font-semibold text-lg text-[var(--text-primary)]">Certified Doctors</h3>
                        <p class="text-sm text-[var(--text-secondary)] mt-2">Find individual psychiatrists and therapists for one-on-one professional care.</p>
                    </div>
                    <div class="bg-white/70 p-6 rounded-lg border border-gray-300/80">
                        <h3 class="font-semibold text-lg text-[var(--text-primary)]">Health Centers</h3>
                        <p class="text-sm text-[var(--text-secondary)] mt-2">Locate clinics and centers that offer a range of mental health services.</p>
                    </div>
                    <div class="bg-white/70 p-6 rounded-lg border border-gray-300/80">
                        <h3 class="font-semibold text-lg text-[var(--text-primary)]">Support Meetups</h3>
                        <p class="text-sm text-[var(--text-secondary)] mt-2">Discover local groups and meetups to share experiences and find community.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="results-section" class="max-w-3xl mx-auto mt-12">
            <div id="loader" class="hidden mx-auto loader"></div>
            <div id="results-container" class="space-y-6"></div>
        </div>
    </main>

    <footer class="bg-[#E9E3D5]/80 backdrop-blur-lg border-t border-gray-300/80 mt-auto">
        <div class="container mx-auto px-6 py-8 text-center">
            <div class="text-[var(--text-secondary)] mb-2">Asha Kiran is a support tool, not a replacement for professional medical advice.</div>
            <div class="text-gray-500 text-sm">© 2025 Asha Kiran. All rights reserved.</div>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Mobile Menu Logic
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    if(mobileMenuButton) {
        mobileMenuButton.addEventListener('click', () => {
            mobileMenuButton.classList.toggle('active');
            if (mobileMenu.style.height && mobileMenu.style.height !== '0px') { mobileMenu.style.height = '0'; } 
            else { mobileMenu.style.height = `${mobileMenu.scrollHeight}px`; }
        });
    }

    // Help Finder Logic
    const searchForm = document.getElementById('search-form');
    const locationInput = document.getElementById('location-input');
    const currentLocationBtn = document.getElementById('current-location-btn');
    const resultsContainer = document.getElementById('results-container');
    const loader = document.getElementById('loader');
    const postSearchInfo = document.getElementById('post-search-info');

    currentLocationBtn.addEventListener('click', () => {
        if (navigator.geolocation) {
            locationInput.placeholder = "Getting your location...";
            navigator.geolocation.getCurrentPosition(position => {
                const { latitude, longitude } = position.coords;
                locationInput.value = `coords:${latitude},${longitude}`;
                locationInput.placeholder = "Location captured!";
            }, () => {
                locationInput.placeholder = "Could not get location. Please enter manually.";
            });
        } else {
            alert("Geolocation is not supported by your browser.");
        }
    });

    searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const location = locationInput.value.trim();
        const resourceType = document.querySelector('input[name="resource-type"]:checked').value;
        
        if (!location) {
            alert("Please provide a location.");
            return;
        }

        resultsContainer.innerHTML = '';
        loader.classList.remove('hidden');
        
        const geminiPrompt = createGeminiPrompt(location, resourceType);
        const responseText = await callGeminiAPI(geminiPrompt);
        
        loader.classList.add('hidden');
        displayResults(responseText);
    });

    function createGeminiPrompt(location, resourceType) {
        let locationQuery = location;
        if (location.startsWith('coords:')) {
            locationQuery = `near the coordinates ${location.replace('coords:', '')}`;
        }

        return `
            Act as an expert local search assistant for India. Your task is to find mental health resources.
            Search the web for the best "${resourceType}" near "${locationQuery}".
            Prioritize results with the best public reviews and ratings (e.g., a 4.5-star rating 5km away is better than a 3.5-star rating 4km away).
            
            For each result you find, format it STRICTLY as follows, using "||" as a separator:
            Name: [Name of the doctor/center/group] || Address: [Full address] || Rating: [Star rating, e.g., 4.5/5, or N/A if not found] || Summary: [A one-sentence summary of public reviews or what they do.] || Google_Maps_Link: [A direct Google Maps URL for the location]
            
            List at least 3 to 5 results if available. Separate each full result with "---".
            If you cannot find any results, just respond with "NO_RESULTS".
        `;
    }
    
    async function callGeminiAPI(prompt) {
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            tools: [{ "google_search": {} }],
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            return result.candidates?.[0]?.content?.parts?.[0]?.text || "NO_RESULTS";
        } catch (error) {
            console.error("API Error:", error);
            return "ERROR: Could not connect to the search service.";
        }
    }

    function displayResults(text) {
        if (!text || text.includes("NO_RESULTS")) {
            resultsContainer.innerHTML = `<p class="text-center text-[var(--text-secondary)]">No results found for your search. Please try a different location or resource type.</p>`;
            return;
        }
        if (text.includes("ERROR:")) {
            resultsContainer.innerHTML = `<p class="text-center text-red-600">${text}</p>`;
            return;
        }

        const results = text.split('---').filter(r => r.trim() !== '');
        results.forEach(result => {
            const parts = result.split('||').map(p => p.trim());
            const data = {};
            parts.forEach(part => {
                const [key, ...value] = part.split(':');
                data[key.trim().toLowerCase().replace(/ /g, '_')] = value.join(':').trim();
            });

            const resultCard = document.createElement('div');
            resultCard.className = 'bg-white/70 backdrop-blur-sm border border-gray-300/80 rounded-lg p-6';
            
            const ratingHTML = data.rating && data.rating.toLowerCase() !== 'n/a'
                ? `<div class="flex items-center gap-1 text-yellow-500 font-bold">
                     <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                     <span>${data.rating}</span>
                   </div>`
                : `<div class="text-sm text-gray-500">No rating available</div>`;
            
            const nameHTML = data.google_maps_link && data.google_maps_link.startsWith('http')
                ? `<a href="${data.google_maps_link}" target="_blank" rel="noopener noreferrer" class="hover:underline text-[var(--primary-dark)]">${data.name || 'N/A'}</a>`
                : `${data.name || 'N/A'}`;

            resultCard.innerHTML = `
                <div class="flex justify-between items-start">
                    <h3 class="text-xl font-bold text-[var(--text-primary)] mb-2">${nameHTML}</h3>
                    ${ratingHTML}
                </div>
                <p class="text-[var(--text-secondary)] font-medium mb-4">${data.address || 'Address not available.'}</p>
                <p class="text-[var(--text-primary)] text-sm">${data.summary || 'No summary available.'}</p>
            `;
            resultsContainer.appendChild(resultCard);
        });
    }
});
</script>
</body>
</html>